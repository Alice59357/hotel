<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é…’åº—æŠ•èµ„å¯è¡Œæ€§è®¡ç®—å™¨ Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header-left p {
            font-size: 16px;
            opacity: 0.9;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: white;
            color: #667eea;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 0;
            min-height: calc(100vh - 200px);
        }

        .sidebar {
            background: #f8f9fa;
            border-right: 1px solid #e0e0e0;
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }

        .content-area {
            padding: 30px;
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin: 20px 20px 15px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }

        .form-group {
            padding: 0 20px;
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #555;
            font-size: 13px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-hint {
            font-size: 11px;
            color: #888;
            margin-top: 5px;
        }

        .radio-group {
            display: flex;
            gap: 8px;
        }

        .radio-option {
            flex: 1;
        }

        .radio-option input[type="radio"] {
            display: none;
        }

        .radio-option label {
            display: block;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin: 0;
            font-size: 13px;
        }

        .radio-option input[type="radio"]:checked + label {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            color: #667eea;
            font-weight: 600;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }

        .kpi-card:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .kpi-label {
            font-size: 12px;
            color: #888;
            margin-bottom: 8px;
        }

        .kpi-value {
            font-size: 24px;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .kpi-sub {
            font-size: 11px;
            color: #999;
        }

        .kpi-card.success {
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.05) 0%, rgba(40, 167, 69, 0.02) 100%);
            border-color: #28a745;
        }

        .kpi-card.warning {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.05) 0%, rgba(255, 193, 7, 0.02) 100%);
            border-color: #ffc107;
        }

        .kpi-card.danger {
            background: linear-gradient(135deg, rgba(220, 53, 69, 0.05) 0%, rgba(220, 53, 69, 0.02) 100%);
            border-color: #dc3545;
        }

        .chart-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #555;
            font-size: 13px;
        }

        .data-table td {
            font-size: 13px;
            color: #333;
        }

        .scenario-table {
            margin-top: 20px;
        }

        .scenario-table tr.best td {
            background: rgba(40, 167, 69, 0.1);
        }

        .scenario-table tr.worst td {
            background: rgba(220, 53, 69, 0.1);
        }

        .recommendations {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .recommendations h4 {
            color: #1976D2;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .recommendations ul {
            list-style: none;
            padding: 0;
        }

        .recommendations li {
            padding: 8px 0;
            font-size: 14px;
            color: #333;
        }

        .recommendations li:before {
            content: 'âœ“';
            color: #2196F3;
            font-weight: bold;
            margin-right: 10px;
        }

        .download-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .sidebar {
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
                max-height: none;
            }

            .content-area {
                max-height: none;
            }

            .chart-row {
                grid-template-columns: 1fr;
            }
        }

        .level-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 5px;
        }

        .level-3 {
            background: #e3f2fd;
            color: #1976d2;
        }

        .level-4 {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .level-5 {
            background: #fff3e0;
            color: #e65100;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <h1>ğŸ¨ é…’åº—æŠ•èµ„å¯è¡Œæ€§è®¡ç®—å™¨ Pro</h1>
                <p>åŸºäºã€Šé…’åº—ç»è¥æŒ‡å—ã€‹- ä¸“ä¸šç‰ˆ | è®©é…’åº—èµ¢åœ¨æŠ•èµ„å‰</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="exportReport()">ğŸ“„ å¯¼å‡ºæŠ¥å‘Š</button>
                <button class="btn btn-primary" onclick="resetAll()">ğŸ”„ é‡ç½®</button>
            </div>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div class="section-title">ğŸ“‹ åŸºæœ¬ä¿¡æ¯</div>

                <div class="form-group">
                    <label>é…’åº—æ¡£æ¬¡ï¼ˆé’»çº§ï¼‰</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="level3" name="hotelLevel" value="3">
                            <label for="level3">3é’»</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="level4" name="hotelLevel" value="4" checked>
                            <label for="level4">4é’»</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="level5" name="hotelLevel" value="5">
                            <label for="level5">5é’»</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="roomCount">æˆ¿é—´æ•°é‡ï¼ˆé—´ï¼‰</label>
                    <input type="number" id="roomCount" value="100" min="10" max="500">
                    <div class="input-hint">ä¸­æ¡£é…’åº—å¸¸è§è§„æ¨¡ï¼š80-150é—´</div>
                </div>

                <div class="form-group">
                    <label for="monthlyRent">æœˆç§Ÿé‡‘ï¼ˆå…ƒ/æœˆï¼‰</label>
                    <input type="number" id="monthlyRent" value="80000" step="1000">
                </div>

                <div class="form-group">
                    <label for="rentPeriod">ç§ŸæœŸï¼ˆå¹´ï¼‰</label>
                    <input type="number" id="rentPeriod" value="10" min="3" max="20">
                </div>

                <div class="section-title">ğŸ’° è¿è¥å‚æ•°</div>

                <div class="form-group">
                    <label for="adr">é¢„æœŸå¹³å‡æˆ¿ä»· ADRï¼ˆå…ƒï¼‰</label>
                    <input type="number" id="adr" value="300" step="10">
                </div>

                <div class="form-group">
                    <label for="occupancy">é¢„æœŸå…¥ä½ç‡ï¼ˆ%ï¼‰</label>
                    <input type="number" id="occupancy" value="75" min="30" max="100" step="5">
                </div>

                <div class="form-group">
                    <label for="investmentCost">è£…ä¿®æŠ•èµ„ï¼ˆå…ƒï¼‰</label>
                    <input type="number" id="investmentCost" value="3000000" step="100000">
                    <div class="input-hint">å«è£…ä¿®ã€å®¶å…·ã€è®¾å¤‡ç­‰</div>
                </div>

                <div class="form-group">
                    <label for="marketingCost">æœˆè¥é”€è´¹ç”¨ï¼ˆå…ƒï¼‰</label>
                    <input type="number" id="marketingCost" value="15000" step="1000">
                    <div class="input-hint">OTAä½£é‡‘ã€æ¨å¹¿ç­‰</div>
                </div>

                <div class="section-title">ğŸ“ é¡¹ç›®ä¿¡æ¯</div>

                <div class="form-group">
                    <label for="projectName">é¡¹ç›®åç§°</label>
                    <input type="text" id="projectName" value="ç¤ºä¾‹é¡¹ç›®" placeholder="è¾“å…¥é¡¹ç›®åç§°">
                </div>

                <div class="form-group">
                    <label for="city">æ‰€åœ¨åŸå¸‚</label>
                    <input type="text" id="city" value="æŸå¸‚" placeholder="è¾“å…¥åŸå¸‚">
                </div>

                <button class="download-btn" style="width: calc(100% - 40px); margin: 20px;" onclick="calculate()">
                    ğŸ“Š é‡æ–°è®¡ç®—
                </button>
            </div>

            <div class="content-area">
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('overview')">ğŸ“ˆ æŠ•èµ„æ¦‚è§ˆ</button>
                    <button class="tab" onclick="switchTab('scenarios')">ğŸ¯ åœºæ™¯åˆ†æ</button>
                    <button class="tab" onclick="switchTab('details')">ğŸ“‹ è¯¦ç»†æ•°æ®</button>
                </div>

                <div id="tab-overview" class="tab-content active">
                    <div class="kpi-grid">
                        <div class="kpi-card" id="kpi-payback">
                            <div class="kpi-label">æŠ•èµ„å›æœ¬å‘¨æœŸ</div>
                            <div class="kpi-value">-- å¹´</div>
                            <div class="kpi-sub">çº¦ -- ä¸ªæœˆ</div>
                        </div>
                        <div class="kpi-card" id="kpi-roi">
                            <div class="kpi-label">å¹´åŒ–æŠ•èµ„å›æŠ¥ç‡</div>
                            <div class="kpi-value">-- %</div>
                            <div class="kpi-sub">å¹´æ”¶ç›Šç‡</div>
                        </div>
                        <div class="kpi-card" id="kpi-profit">
                            <div class="kpi-label">å¹´åº¦é¢„æœŸåˆ©æ¶¦</div>
                            <div class="kpi-value">Â¥ --</div>
                            <div class="kpi-sub">åˆ©æ¶¦ç‡ --%</div>
                        </div>
                        <div class="kpi-card" id="kpi-revenue">
                            <div class="kpi-label">å¹´åº¦è¥æ”¶é¢„æµ‹</div>
                            <div class="kpi-value">Â¥ --</div>
                            <div class="kpi-sub">æœˆå‡ Â¥ --</div>
                        </div>
                    </div>

                    <div class="chart-row">
                        <div class="chart-container">
                            <div class="chart-title">æœˆåº¦æˆæœ¬ç»“æ„åˆ†æ</div>
                            <canvas id="costChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-title">è¥æ”¶åˆ©æ¶¦è¶‹åŠ¿ï¼ˆæœªæ¥5å¹´ï¼‰</div>
                            <canvas id="trendChart"></canvas>
                        </div>
                    </div>

                    <div class="recommendations" id="recommendations">
                        <h4>ğŸ’¡ æŠ•èµ„å»ºè®®</h4>
                        <ul id="recommendation-list">
                            <li>è¯·å®Œå–„å·¦ä¾§ä¿¡æ¯åæŸ¥çœ‹åˆ†æç»“æœ</li>
                        </ul>
                    </div>
                </div>

                <div id="tab-scenarios" class="tab-content">
                    <div class="chart-container">
                        <div class="chart-title">ğŸ¯ ä¸‰åœºæ™¯å¯¹æ¯”åˆ†æ</div>
                        <p style="color: #666; font-size: 13px; margin-bottom: 15px;">
                            å¯¹æ¯”ä¿å®ˆã€åŸºå‡†ã€ä¹è§‚ä¸‰ç§åœºæ™¯ä¸‹çš„æŠ•èµ„è¡¨ç°
                        </p>
                        <table class="data-table scenario-table">
                            <thead>
                                <tr>
                                    <th>æŒ‡æ ‡</th>
                                    <th>ä¿å®ˆåœºæ™¯<br><small>å…¥ä½ç‡60%</small></th>
                                    <th>åŸºå‡†åœºæ™¯<br><small>å…¥ä½ç‡75%</small></th>
                                    <th>ä¹è§‚åœºæ™¯<br><small>å…¥ä½ç‡85%</small></th>
                                </tr>
                            </thead>
                            <tbody id="scenario-tbody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="tab-details" class="tab-content">
                    <div class="chart-container">
                        <div class="chart-title">ğŸ“‹ æœˆåº¦æ”¶æ”¯æ˜ç»†</div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>é¡¹ç›®</th>
                                    <th>æœˆåº¦é‡‘é¢</th>
                                    <th>å¹´åº¦é‡‘é¢</th>
                                    <th>å è¥æ”¶æ¯”ä¾‹</th>
                                </tr>
                            </thead>
                            <tbody id="detail-tbody">
                            </tbody>
                        </table>
                    </div>

                    <div class="chart-container" style="margin-top: 20px;">
                        <div class="chart-title">ğŸ¨ é…’åº—æ¡£æ¬¡è¦æ±‚è¯´æ˜</div>
                        <div id="level-requirements"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ ¸å¿ƒæ•°æ®
        const OPERATING_COST_PER_ROOM = { 3: 60, 4: 100, 5: 150 };
        const STAFF_RATIO = { 3: 0.17, 4: 0.26, 5: 0.30 };
        const AVG_SALARY = 4500;
        const LEVEL_NAMES = { 3: '3é’»ï¼ˆç»æµå‹ï¼‰', 4: '4é’»ï¼ˆä¸­æ¡£ï¼‰', 5: '5é’»ï¼ˆé«˜æ¡£ï¼‰' };

        // é’»çº§è¦æ±‚è¯´æ˜
        const LEVEL_REQUIREMENTS = {
            3: {
                name: '3é’»é…’åº—ï¼ˆç»æµå‹ï¼‰',
                requirements: [
                    'âœ“ é¤å…ï¼šè‡³å°‘5å¼ é¤æ¡Œæˆ–åˆä½œæä¾›æ—©é¤',
                    'âœ“ ä¼šè®®å®¤ï¼šå®¹çº³è‡³å°‘10äºº',
                    'âœ“ åŸºç¡€è®¾æ–½ï¼šå…¬å…±åŒºåŸŸWiFi',
                    'âœ“ å®¢æˆ¿ï¼šç‹¬ç«‹å«ç”Ÿé—´ã€24å°æ—¶çƒ­æ°´ã€ç©ºè°ƒã€ç”µè§†'
                ],
                operatingCost: '60å…ƒ/é—´Â·å¤©'
            },
            4: {
                name: '4é’»é…’åº—ï¼ˆä¸­æ¡£ï¼‰',
                requirements: [
                    'âœ“ é¤å…ï¼šæä¾›å•ç‚¹æˆ–è‡ªåŠ©æ—©é¤',
                    'âœ“ å¥èº«æˆ¿ï¼šè‡³å°‘3é¡¹å¥èº«å™¨æ',
                    'âœ“ ä¼šè®®å®¤ï¼šå®¹çº³è‡³å°‘30äºº',
                    'âœ“ åœè½¦åœºï¼šé…’åº—æˆ–é™„è¿‘æœ‰åœè½¦åœº',
                    'âœ“ ç‹¬ç«‹å¤§å ‚åŠå‰å°ï¼Œé…å¤‡å¤§å ‚ç»ç†',
                    'âœ“ å®¢æˆ¿ï¼šå°å†°ç®±/è¿·ä½ å§ã€æ²™å‘ã€è¡£æŸœ'
                ],
                operatingCost: '100å…ƒ/é—´Â·å¤©'
            },
            5: {
                name: '5é’»é…’åº—ï¼ˆé«˜æ¡£ï¼‰',
                requirements: [
                    'âœ“ é¤å…ï¼šå¤šä¸ªé¤å…ï¼Œæä¾›è‡ªåŠ©é¤æ—©åˆæ™šé¤',
                    'âœ“ å¥èº«æˆ¿ï¼šè‡³å°‘5é¡¹å¥èº«å™¨æ',
                    'âœ“ å…¶ä»–å¨±ä¹è®¾æ–½ï¼šè‡³å°‘2é¡¹ï¼ˆæ³³æ± /SPAç­‰ï¼‰',
                    'âœ“ ä¼šè®®å®¤ï¼šå®¹çº³è‡³å°‘50äºº',
                    'âœ“ åœè½¦åœºï¼šä¸å°‘äº15%å®¢æˆ¿æ€»æ•°',
                    'âœ“ å®´ä¼šå…/å¤šåŠŸèƒ½å…',
                    'âœ“ é…’å§/èŒ¶å®¤/å’–å•¡å…ï¼ˆè‡³å°‘1é¡¹ï¼‰',
                    'âœ“ éƒ¨åˆ†å®¢æˆ¿å¸¦æ™ºèƒ½é©¬æ¡¶ã€é˜³å°'
                ],
                operatingCost: '150å…ƒ/é—´Â·å¤©'
            }
        };

        let costChart = null;
        let trendChart = null;

        function calculate() {
            const hotelLevel = parseInt(document.querySelector('input[name="hotelLevel"]:checked').value);
            const roomCount = parseFloat(document.getElementById('roomCount').value);
            const monthlyRent = parseFloat(document.getElementById('monthlyRent').value);
            const adr = parseFloat(document.getElementById('adr').value);
            const occupancy = parseFloat(document.getElementById('occupancy').value) / 100;
            const investmentCost = parseFloat(document.getElementById('investmentCost').value);
            const marketingCost = parseFloat(document.getElementById('marketingCost').value);

            const monthlyRevenue = roomCount * adr * 30 * occupancy;
            const annualRevenue = monthlyRevenue * 12;

            const operatingCostPerRoom = OPERATING_COST_PER_ROOM[hotelLevel];
            const monthlyOperatingCost = roomCount * operatingCostPerRoom * 30 * occupancy;
            const annualOperatingCost = monthlyOperatingCost * 12;

            const staffCount = Math.round(roomCount * STAFF_RATIO[hotelLevel]);
            const monthlyLaborCost = staffCount * AVG_SALARY;
            const annualLaborCost = monthlyLaborCost * 12;

            const monthlyTotalCost = monthlyRent + monthlyOperatingCost + monthlyLaborCost + marketingCost;
            const annualTotalCost = monthlyTotalCost * 12;

            const monthlyProfit = monthlyRevenue - monthlyTotalCost;
            const annualProfit = monthlyProfit * 12;
            const profitMargin = (monthlyProfit / monthlyRevenue * 100);

            const rentRatio = (monthlyRent / monthlyRevenue * 100);
            const laborRatio = (monthlyLaborCost / monthlyRevenue * 100);
            const operatingRatio = (monthlyOperatingCost / monthlyRevenue * 100);
            const marketingRatio = (marketingCost / monthlyRevenue * 100);

            const paybackMonths = investmentCost / monthlyProfit;
            const paybackYears = paybackMonths / 12;
            const roi = (annualProfit / investmentCost * 100);

            // æ›´æ–°KPIå¡ç‰‡
            updateKPI('kpi-payback', paybackYears.toFixed(1) + ' å¹´', `çº¦ ${Math.ceil(paybackMonths)} ä¸ªæœˆ`,
                paybackYears > 8 ? 'danger' : paybackYears > 5 ? 'warning' : 'success');
            updateKPI('kpi-roi', roi.toFixed(1) + '%', 'å¹´åŒ–æ”¶ç›Šç‡',
                roi < 10 ? 'danger' : roi < 20 ? 'warning' : 'success');
            updateKPI('kpi-profit', formatCurrency(annualProfit), `åˆ©æ¶¦ç‡ ${profitMargin.toFixed(1)}% | æœˆå‡ ${formatCurrency(monthlyProfit)}`,
                profitMargin < 10 ? 'danger' : profitMargin < 25 ? 'warning' : 'success');
            updateKPI('kpi-revenue', formatCurrency(annualRevenue), `æœˆå‡ ${formatCurrency(monthlyRevenue)}`);

            // æ›´æ–°æˆæœ¬ç»“æ„å›¾è¡¨
            updateCostChart(monthlyRent, monthlyLaborCost, monthlyOperatingCost, marketingCost, monthlyProfit);

            // æ›´æ–°è¶‹åŠ¿å›¾è¡¨
            updateTrendChart(annualRevenue, annualProfit, investmentCost);

            // æ›´æ–°å»ºè®®
            updateRecommendations(rentRatio, profitMargin, paybackYears, roi, hotelLevel);

            // æ›´æ–°åœºæ™¯åˆ†æ
            updateScenarios(roomCount, adr, investmentCost, monthlyRent, monthlyOperatingCost / (30 * occupancy),
                staffCount * AVG_SALARY, marketingCost, hotelLevel);

            // æ›´æ–°è¯¦ç»†æ•°æ®
            updateDetails(monthlyRevenue, monthlyRent, monthlyLaborCost, monthlyOperatingCost,
                marketingCost, monthlyTotalCost, monthlyProfit, annualRevenue);

            // æ›´æ–°é’»çº§è¦æ±‚
            updateLevelRequirements(hotelLevel);

            return { monthlyProfit, paybackYears, roi, profitMargin, rentRatio };
        }

        function updateKPI(id, value, sub, status = '') {
            const card = document.getElementById('kpi-card' + id.replace('kpi-', ''));
            const valueEl = document.querySelector(`#${id} .kpi-value`);
            const subEl = document.querySelector(`#${id} .kpi-sub`);

            valueEl.textContent = value;
            subEl.textContent = sub;

            if (status) {
                document.getElementById(id).className = 'kpi-card ' + status;
            }
        }

        function updateCostChart(rent, labor, operating, marketing, profit) {
            const ctx = document.getElementById('costChart').getContext('2d');

            if (costChart) costChart.destroy();

            costChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ç§Ÿé‡‘', 'äººå·¥æˆæœ¬', 'è¿è¥æˆæœ¬', 'è¥é”€è´¹ç”¨', 'åˆ©æ¶¦'],
                    datasets: [{
                        data: [rent, labor, operating, marketing, profit],
                        backgroundColor: [
                            '#FF6384',
                            '#36A2EB',
                            '#FFCE56',
                            '#4BC0C0',
                            '#4CAF50'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function updateTrendChart(revenue, profit, investment) {
            const ctx = document.getElementById('trendChart').getContext('2d');

            if (trendChart) trendChart.destroy();

            const years = [];
            const cumulativeProfits = [];
            let cumulative = -investment;

            for (let i = 1; i <= 5; i++) {
                years.push('ç¬¬' + i + 'å¹´');
                cumulative += profit;
                cumulativeProfits.push(cumulative);
            }

            trendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'ç´¯è®¡æ”¶ç›Š',
                        data: cumulativeProfits,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        function updateRecommendations(rentRatio, profitMargin, paybackYears, roi, level) {
            const list = document.getElementById('recommendation-list');
            const recommendations = [];

            if (rentRatio > 50) {
                recommendations.push('âš ï¸ <strong>ç§Ÿé‡‘å æ¯”è¿‡é«˜ï¼ˆ' + rentRatio.toFixed(1) + '%ï¼‰</strong>ï¼šè¿œè¶…å¥åº·å€¼30-40%ï¼Œå¼ºçƒˆå»ºè®®é‡æ–°è°ˆåˆ¤ç§Ÿé‡‘æˆ–å¯»æ‰¾å…¶ä»–ç‰©ä¸š');
            } else if (rentRatio > 40) {
                recommendations.push('âš ï¸ <strong>ç§Ÿé‡‘å æ¯”åé«˜ï¼ˆ' + rentRatio.toFixed(1) + '%ï¼‰</strong>ï¼šè¶…è¿‡å¥åº·å€¼ä¸Šé™ï¼Œéœ€è°¨æ…è¯„ä¼°ï¼Œå»ºè®®æ§åˆ¶åœ¨40%ä»¥ä¸‹');
            } else if (rentRatio < 30) {
                recommendations.push('âœ… <strong>ç§Ÿé‡‘å æ¯”å¥åº·ï¼ˆ' + rentRatio.toFixed(1) + '%ï¼‰</strong>ï¼šåœ¨åˆç†èŒƒå›´å†…ï¼Œæœ‰åˆ©äºé¡¹ç›®ç›ˆåˆ©');
            }

            if (profitMargin < 10) {
                recommendations.push('âš ï¸ <strong>åˆ©æ¶¦ç‡è¿‡ä½ï¼ˆ' + profitMargin.toFixed(1) + '%ï¼‰</strong>ï¼šæŠ•èµ„é£é™©è¾ƒå¤§ï¼Œå»ºè®®é‡æ–°è¯„ä¼°å®šä»·å’Œæˆæœ¬ç»“æ„');
            } else if (profitMargin > 25) {
                recommendations.push('âœ… <strong>åˆ©æ¶¦ç‡è‰¯å¥½ï¼ˆ' + profitMargin.toFixed(1) + '%ï¼‰</strong>ï¼šé¡¹ç›®å…·æœ‰è¾ƒå¼ºçš„ç›ˆåˆ©èƒ½åŠ›');
            }

            if (paybackYears > 8) {
                recommendations.push('âŒ <strong>å›æœ¬å‘¨æœŸè¿‡é•¿ï¼ˆ' + paybackYears.toFixed(1) + 'å¹´ï¼‰</strong>ï¼šä¸å»ºè®®æŠ•èµ„ï¼Œé…’åº—è¡Œä¸šåˆç†å›æœ¬æœŸåº”åœ¨3-6å¹´');
            } else if (paybackYears < 4) {
                recommendations.push('âœ… <strong>å›æœ¬å‘¨æœŸç†æƒ³ï¼ˆ' + paybackYears.toFixed(1) + 'å¹´ï¼‰</strong>ï¼šé¡¹ç›®å›æ”¶å‘¨æœŸè¾ƒçŸ­ï¼ŒæŠ•èµ„ä»·å€¼è¾ƒé«˜');
            } else {
                recommendations.push('âš ï¸ <strong>å›æœ¬å‘¨æœŸå¯æ¥å—ï¼ˆ' + paybackYears.toFixed(1) + 'å¹´ï¼‰</strong>ï¼šåœ¨è¡Œä¸šåˆç†èŒƒå›´å†…');
            }

            if (roi < 15) {
                recommendations.push('âš ï¸ <strong>æŠ•èµ„å›æŠ¥ç‡åä½ï¼ˆ' + roi.toFixed(1) + '%ï¼‰</strong>ï¼šè€ƒè™‘å…¶ä»–æŠ•èµ„æ¸ é“å¯èƒ½æ›´åˆé€‚');
            } else if (roi > 30) {
                recommendations.push('âœ… <strong>æŠ•èµ„å›æŠ¥ç‡ä¼˜ç§€ï¼ˆ' + roi.toFixed(1) + '%ï¼‰</strong>ï¼šé¡¹ç›®å…·æœ‰è¾ƒé«˜çš„æŠ•èµ„ä»·å€¼');
            }

            // æ¡£æ¬¡å»ºè®®
            if (level === 3) {
                recommendations.push('ğŸ’¡ <strong>3é’»é…’åº—</strong>ï¼šé€‚åˆç»æµå‹å®šä½ï¼Œå•æˆ¿è¿è¥æˆæœ¬è¾ƒä½ï¼ˆ60å…ƒ/é—´Â·å¤©ï¼‰ï¼Œå»ºè®®æ§åˆ¶è£…ä¿®æŠ•å…¥');
            } else if (level === 4) {
                recommendations.push('ğŸ’¡ <strong>4é’»é…’åº—</strong>ï¼šä¸­æ¡£å¸‚åœºä¸»æµé€‰æ‹©ï¼Œå¹³è¡¡æŠ•å…¥ä¸å›æŠ¥ï¼Œéœ€æ³¨é‡æœåŠ¡è´¨é‡');
            } else {
                recommendations.push('ğŸ’¡ <strong>5é’»é…’åº—</strong>ï¼šé«˜ç«¯å®šä½ï¼Œè¿è¥æˆæœ¬é«˜ï¼ˆ150å…ƒ/é—´Â·å¤©ï¼‰ï¼Œéœ€è¦è¾ƒå¼ºçš„å“ç‰Œå’Œè¿è¥èƒ½åŠ›');
            }

            list.innerHTML = recommendations.map(r => '<li>' + r + '</li>').join('');
        }

        function updateScenarios(roomCount, adr, investment, rent, operatingCost, laborCost, marketing, level) {
            const tbody = document.getElementById('scenario-tbody');
            const scenarios = [
                { name: 'ä¿å®ˆ', occupancy: 0.6, class: 'worst' },
                { name: 'åŸºå‡†', occupancy: 0.75, class: '' },
                { name: 'ä¹è§‚', occupancy: 0.85, class: 'best' }
            ];

            let html = '';
            scenarios.forEach(scenario => {
                const revenue = roomCount * adr * 30 * scenario.occupancy * 12;
                const totalCost = (rent + operatingCost * roomCount * scenario.occupancy * 30 + laborCost + marketing) * 12;
                const profit = revenue - totalCost;
                const margin = (profit / revenue * 100);
                const payback = investment / (profit / 12);
                const roi = (profit / investment * 100);

                html += `
                    <tr class="${scenario.class}">
                        <td><strong>${scenario.name}åœºæ™¯</strong></td>
                        <td>${formatCurrency(revenue)}</td>
                        <td>${formatCurrency(profit)}<br><small>${margin.toFixed(1)}%</small></td>
                        <td>${payback.toFixed(1)}å¹´<br><small>ROI ${roi.toFixed(1)}%</small></td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        function updateDetails(monthlyRevenue, rent, labor, operating, marketing, total, profit, annualRevenue) {
            const tbody = document.getElementById('detail-tbody');

            const items = [
                { name: 'ğŸ“Š è¥ä¸šæ”¶å…¥', monthly: monthlyRevenue, percent: 100 },
                { name: 'ğŸ’° ç§Ÿé‡‘æˆæœ¬', monthly: rent },
                { name: 'ğŸ‘¥ äººå·¥æˆæœ¬', monthly: labor },
                { name: 'ğŸ  è¿è¥æˆæœ¬', monthly: operating },
                { name: 'ğŸ“¢ è¥é”€è´¹ç”¨', monthly: marketing },
                { name: 'âœ… è¥ä¸šåˆ©æ¶¦', monthly: profit, bold: true }
            ];

            let html = '';
            items.forEach(item => {
                html += `
                    <tr ${item.bold ? 'style="font-weight: 600; background: #f8f9fa;"' : ''}>
                        <td>${item.name}</td>
                        <td>${formatCurrency(item.monthly)}</td>
                        <td>${formatCurrency(item.monthly * 12)}</td>
                        <td>${item.percent !== undefined ? item.percent.toFixed(1) + '%' : ((item.monthly / monthlyRevenue * 100).toFixed(1) + '%')}</td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        function updateLevelRequirements(level) {
            const div = document.getElementById('level-requirements');
            const info = LEVEL_REQUIREMENTS[level];

            let html = `
                <h3 style="margin-bottom: 15px; color: #333;">
                    ${info.name}
                    <span class="level-badge level-${level}">è¿è¥æˆæœ¬: ${info.operatingCost}</span>
                </h3>
                <ul style="list-style: none; padding: 0; line-height: 2;">
            `;

            info.requirements.forEach(req => {
                html += `<li style="padding: 5px 0; color: #555;">${req}</li>`;
            });

            html += '</ul>';
            div.innerHTML = html;
        }

        function formatCurrency(num) {
            if (Math.abs(num) >= 100000000) {
                return 'Â¥' + (num / 100000000).toFixed(2) + 'äº¿';
            } else if (Math.abs(num) >= 10000) {
                return 'Â¥' + (num / 10000).toFixed(2) + 'ä¸‡';
            } else {
                return 'Â¥' + num.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            }
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById('tab-' + tabName).classList.add('active');
        }

        function resetAll() {
            document.getElementById('roomCount').value = 100;
            document.getElementById('monthlyRent').value = 80000;
            document.getElementById('rentPeriod').value = 10;
            document.getElementById('adr').value = 300;
            document.getElementById('occupancy').value = 75;
            document.getElementById('investmentCost').value = 3000000;
            document.getElementById('marketingCost').value = 15000;
            document.querySelector('input[name="hotelLevel"][value="4"]').checked = true;
            calculate();
        }

        function exportReport() {
            const projectName = document.getElementById('projectName').value || 'é…’åº—æŠ•èµ„é¡¹ç›®';
            const city = document.getElementById('city').value || '';
            const hotelLevel = document.querySelector('input[name="hotelLevel"]:checked').value;
            const levelName = LEVEL_NAMES[hotelLevel];

            const report = `
é…’åº—æŠ•èµ„å¯è¡Œæ€§åˆ†ææŠ¥å‘Š
========================

é¡¹ç›®åç§°: ${projectName}
æ‰€åœ¨åŸå¸‚: ${city}
é…’åº—æ¡£æ¬¡: ${levelName}
ç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString()}

ä¸€ã€é¡¹ç›®æ¦‚å†µ
------------
${document.getElementById('roomCount').value}é—´å®¢æˆ¿ | æœˆç§Ÿé‡‘${formatCurrency(parseFloat(document.getElementById('monthlyRent').value))}
é¢„æœŸæˆ¿ä»·: Â¥${document.getElementById('adr').value}/é—´å¤œ | ç›®æ ‡å…¥ä½ç‡: ${document.getElementById('occupancy').value}%
è£…ä¿®æŠ•èµ„: ${formatCurrency(parseFloat(document.getElementById('investmentCost').value))}

äºŒã€æŠ•èµ„åˆ†æ
------------
æŠ•èµ„å›æœ¬å‘¨æœŸ: ${document.querySelector('#kpi-payback .kpi-value').textContent}
å¹´åŒ–ROI: ${document.querySelector('#kpi-roi .kpi-value').textContent}
å¹´åº¦é¢„æœŸåˆ©æ¶¦: ${document.querySelector('#kpi-profit .kpi-value').textContent}

ä¸‰ã€æŠ•èµ„å»ºè®®
------------
${Array.from(document.querySelectorAll('#recommendation-list li')).map(li => li.textContent).join('\n')}

---
æœ¬æŠ¥å‘Šç”±ã€Šé…’åº—ç»è¥æŒ‡å—ã€‹é…’åº—æŠ•èµ„å¯è¡Œæ€§è®¡ç®—å™¨ç”Ÿæˆ
            `;

            const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${projectName}_æŠ•èµ„åˆ†ææŠ¥å‘Š_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è®¡ç®—
        window.onload = function() {
            calculate();
        };

        // ç›‘å¬æ‰€æœ‰è¾“å…¥å˜åŒ–ï¼Œè‡ªåŠ¨é‡æ–°è®¡ç®—
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('change', calculate);
        });
    </script>
</body>
</html>